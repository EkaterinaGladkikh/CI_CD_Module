pipeline {
    agent any 
    environment {
        PATH = "C:/path/to/new/virtual/environment/Scripts/python.exe;$PATH"
    }
    stages {
        stage('install req') { 
            steps {
                sh '''python -m venv /path/to/new/virtual/environment
                       pip install -r requirements.txt
                ''' 
            }
        }
        stage('run tests') { 
            steps {
                sh 'pytest main.py' 
            }
        }
    }
}
